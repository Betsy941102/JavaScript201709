<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }
        #div1{
            width: 100px;
            height: 100px;
            background: red;
            position: absolute;
            left: 100px;
            top: 100px;
            cursor: move;
            -webkit-user-select: none;
        }
    </style>
</head>
<body>
<div id="div1"></div>
</body>
</html>
<script>
    /*盒子拖拽
    按下时拖拽开始
    鼠标按着并移动,进行拖拽
    鼠标松开拖拽停止
    * */
    var oDiv  = document.getElementById("div1");
    oDiv.onmousedown = down;
    function process(fn,ele){
        return function(e){
            fn.call(ele,e);
        }
    }
    function down(e){
        e = e||window.event;
        this.x = this.offsetLeft;
        this.y = this.offsetTop;
        this.mx = e.clientX;
        this.my = e.clientY;
        if(this.setCapture){
            this.setCapture();
            this.onmousemove = move;
            this.onmouseup = up;
        }else{
            var MOVE= process(move,this);
            var UP = process(up,this);
            document.onmousemove =MOVE;
            document.onmouseup = UP;
        }
        clearInterval(this.flyTimer);
//        clearInterval(this.dropTimer);
    }
    //盒子移动的距离 = 盒子原来的距离+鼠标移动的距离
    //鼠标移动的距离 = 鼠标现在的位置-鼠标按下时的位置
    function move(e){
        e = e||window.event;
        this.style.left = this.x+(e.clientX-this.mx)+"px";
        this.style.top = this.y+(e.clientY-this.my)+"px";
        if(!this.prev){
            this.prev = e.clientX;
        }
        this.speed = e.clientX - this.prev;
        this.prev = e.clientX;
    }
    function up(){
        if(this.releaseCapture){
            this.releaseCapture();
            this.onmousemove = null;
            this.onmouseup = null;
        }else{
            document.onmousemove = null;
            document.onmouseup = null;
        }
        fly.call(this);
//        drop.call(this);
    }

    function fly(){
        clearTimeout(this.flyTimer);
        console.log(this.speed);
        this.speed*=0.98;
        var rSide = (document.documentElement.clientWidth||document.body.clientWidth)- this.offsetWidth;
        var x = this.offsetLeft+this.speed;
        if(x>=rSide){
            this.style.left = rSide+"px";
            this.speed*=-1;
        }else if(x<=0){
            this.style.left = 0;
            this.speed*=-1;
        }else{
            this.style.left =x+"px";
        }
        if(Math.abs(this.speed)>0.5){
            this.flyTimer = window.setTimeout(process(fly,this),30);
        }

    }

    var g = 9.8;
    var flag = 1;
    function drop(){
        console.log(1);
        window.clearTimeout(this.dropTimer);
        var tSide = (document.documentElement.clientHeight||document.body.clientHeight)- this.offsetHeight;
        if(!this.dropSpeed){
            this.dropSpeed =g;
        }else{
            this.dropSpeed+=g;
        }
        this.dropSpeed*=0.97;
        var y = this.offsetTop+this.dropSpeed;
        if(y>tSide){
            this.style.top = tSide+"px";
            this.dropSpeed*=-1;
            flag++;
        }else{
            this.style.top = y+"px";
            flag = 0;
        }
        if(flag<2){
            this.dropTimer = window.setTimeout(process(drop,this),30)
        }

    }

</script>